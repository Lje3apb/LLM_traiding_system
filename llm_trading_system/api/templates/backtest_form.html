{% extends "base.html" %}

{% block title %}Run Backtest - {{ name }} - LLM Trading System{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Run Backtest: {{ name }}</h2>
    <a href="/ui/strategies/{{ name }}/edit" class="btn btn-secondary">Edit Strategy</a>
</div>

<form method="POST" action="/ui/strategies/{{ name }}/backtest" class="strategy-form">
    <div class="form-section">
        <h3>Backtest Parameters</h3>

        <div class="form-group">
            <label for="data_path">Data File Path</label>
            <input type="text" id="data_path" name="data_path" placeholder="/path/to/data.csv" required>
            <p class="help-text">Path to CSV file with OHLCV data (timestamp, open, high, low, close, volume)</p>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="initial_equity">Initial Equity</label>
                <input type="number" id="initial_equity" name="initial_equity" value="10000.0" step="100" min="0" required>
            </div>

            <div class="form-group">
                <label for="fee_rate">Fee Rate</label>
                <input type="number" id="fee_rate" name="fee_rate" value="0.001" step="0.0001" min="0" required>
                <p class="help-text">0.001 = 0.1%</p>
            </div>

            <div class="form-group">
                <label for="slippage_bps">Slippage (bps)</label>
                <input type="number" id="slippage_bps" name="slippage_bps" value="1.0" step="0.1" min="0" required>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>LLM Settings (Optional)</h3>

        <div class="form-group">
            <label>
                <input type="checkbox" name="use_llm" id="use_llm">
                Use LLM (requires Ollama running)
            </label>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="llm_model">LLM Model</label>
                <input type="text" id="llm_model" name="llm_model" value="llama3.2">
            </div>

            <div class="form-group">
                <label for="llm_url">Ollama URL</label>
                <input type="text" id="llm_url" name="llm_url" value="http://localhost:11434">
            </div>
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-success">Run Backtest</button>
        <a href="/ui/" class="btn btn-secondary">Cancel</a>
    </div>
</form>

<div class="form-section">
    <h3>Strategy Configuration</h3>
    <div class="metrics-grid">
        <div class="metric">
            <span class="metric-label">Type</span>
            <span class="metric-value">{{ config.get('strategy_type', 'N/A') }}</span>
        </div>
        <div class="metric">
            <span class="metric-label">Mode</span>
            <span class="metric-value">{{ config.get('mode', 'N/A') }}</span>
        </div>
        <div class="metric">
            <span class="metric-label">Symbol</span>
            <span class="metric-value">{{ config.get('symbol', 'N/A') }}</span>
        </div>
        <div class="metric">
            <span class="metric-label">Base Size</span>
            <span class="metric-value">{{ config.get('base_size', 'N/A') }}</span>
        </div>
    </div>
</div>
{% endblock %}
