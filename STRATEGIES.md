# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π](#1-–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã-—Å—Ç—Ä–∞—Ç–µ–≥–∏–π)
2. [–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤](#2-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)
3. [–§–æ—Ä–º–∞—Ç JSON-–ø—Ä–∞–≤–∏–ª (Trading Rules)](#3-—Ñ–æ—Ä–º–∞—Ç-json-–ø—Ä–∞–≤–∏–ª-trading-rules)
4. [–ü—Ä–∏–º–µ—Ä: –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–∑ TradingView (Pine Script)](#4-–ø—Ä–∏–º–µ—Ä-–ø–µ—Ä–µ–Ω–æ—Å-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏-–∏–∑-tradingview-pine-script)
5. [–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é](#5-–∫–∞–∫-–¥–æ–±–∞–≤–∏—Ç—å-–Ω–æ–≤—É—é-—Å—Ç—Ä–∞—Ç–µ–≥–∏—é)
6. [–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å LLM-—Ä–µ–∂–∏–º–æ–º](#6-—Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-—Å-llm-—Ä–µ–∂–∏–º–æ–º)

---

## 1. –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —É—Ä–æ–≤–Ω—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:

### 1.1 LLM-—Ä–µ–∂–∏–º—ã (llm_regime_strategy.py, regime_engine.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–≤–µ—Ç—Ä–∞ —Ä—ã–Ω–∫–∞" —Å –ø–æ–º–æ—â—å—é –±–æ–ª—å—à–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π.

- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ —Å–Ω–∏–º–∫–∏ (market snapshots) —Å –ø–æ–º–æ—â—å—é LLM
- –í—ã–¥–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –±—ã—á—å–µ–≥–æ/–º–µ–¥–≤–µ–∂—å–µ–≥–æ —Ä–µ–∂–∏–º–∞: `prob_bull`, `prob_bear`
- –í—ã—á–∏—Å–ª—è–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏: `k_long`, `k_short`
- –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

**–§–∞–π–ª—ã**:
- `llm_trading_system/core/regime_engine.py` ‚Äî –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
- `llm_trading_system/strategies/llm_regime_strategy.py` ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ LLM

### 1.2 –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (indicator_strategy.py, indicators.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ß–∏—Å—Ç–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ –ø–æ —Ü–µ–Ω–∞–º –∏ –æ–±—ä–µ–º–∞–º (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑).

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, SMA, EMA, Bollinger Bands, ATR –∏ –¥—Ä.)
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ JSON-–ø—Ä–∞–≤–∏–ª–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∏—Ä–∞–º–∏–¥–∏–Ω–≥ (pyramiding) –∏ –º–∞—Ä—Ç–∏–Ω–≥–µ–π–ª
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Take Profit / Stop Loss
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (—Ç–æ—Ä–≥–æ–≤–ª—è –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —á–∞—Å—ã)

**–§–∞–π–ª—ã**:
- `llm_trading_system/strategies/indicator_strategy.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- `llm_trading_system/strategies/indicators.py` ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- `llm_trading_system/strategies/rules.py` ‚Äî –¥–≤–∏–∂–æ–∫ –ø—Ä–∞–≤–∏–ª (DSL)
- `llm_trading_system/strategies/configs.py` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

### 1.3 Backtester –∏ –ø–æ—Ä—Ç—Ñ–µ–ª—å (backtester.py, portfolio.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –∏ —Ä–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

- `backtester.py` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- `portfolio.py` ‚Äî —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤, –≤–µ–¥—ë—Ç —É—á—ë—Ç –ø–æ–∑–∏—Ü–∏–π –∏ —ç–∫–≤–∏—Ç–∏
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏, –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (slippage)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∏–≤—É—é –∫–∞–ø–∏—Ç–∞–ª–∞, —Å–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫, –∏—Ç–æ–≥–æ–≤—É—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ—Å–∞–¥–∫—É

**–§–∞–π–ª—ã**:
- `llm_trading_system/engine/backtester.py`
- `llm_trading_system/engine/portfolio.py`
- `llm_trading_system/engine/data_feed.py`

### 1.4 –ö–∞–∫ –æ–Ω–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –î–ê–ù–ù–´–ï (data_feed)                      ‚îÇ
‚îÇ              OHLCV bars ‚Üí Backtester                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   –°–¢–†–ê–¢–ï–ì–ò–Ø (Strategy)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  LLM –†–µ–∂–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ —á–µ—Ä–µ–∑ LLM                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã k_long, k_short                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                       ‚Üì (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –í—ã—á–∏—Å–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, BB, SMA, vol_ma...)    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JSON-–ø—Ä–∞–≤–∏–ª–∞ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç TP/SL, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∏—Ä–∞–º–∏–¥–∏–Ω–≥ –∏ –º–∞—Ä—Ç–∏–Ω–≥–µ–π–ª                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                              ‚Üì                              ‚îÇ
‚îÇ                   –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Order                          ‚îÇ
‚îÇ              (long/short/flat + size)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               –ü–û–†–¢–§–ï–õ–¨ (PortfolioSimulator)                 ‚îÇ
‚îÇ  ‚Ä¢ –ò—Å–ø–æ–ª–Ω—è–µ—Ç –æ—Ä–¥–µ—Ä–∞                                         ‚îÇ
‚îÇ  ‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é, —ç–∫–≤–∏—Ç–∏, —Å–¥–µ–ª–∫–∏                      ‚îÇ
‚îÇ  ‚Ä¢ –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  –†–ï–ó–£–õ–¨–¢–ê–¢–´ (BacktestResult)                ‚îÇ
‚îÇ  ‚Ä¢ –ö—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞                                          ‚îÇ
‚îÇ  ‚Ä¢ –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫                                            ‚îÇ
‚îÇ  ‚Ä¢ –ò—Ç–æ–≥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 2. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

### 2.1 –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

–í—Å–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –º–æ–¥—É–ª–µ:
```
llm_trading_system/strategies/indicators.py
```

### 2.2 –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

#### SMA (Simple Moving Average)

```python
def sma(values: Sequence[float], length: int) -> float | None
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `values` ‚Äî —Å–ø–∏—Å–æ–∫ —Ü–µ–Ω (–æ—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º)
- `length` ‚Äî –ø–µ—Ä–∏–æ–¥ —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –∑–Ω–∞—á–µ–Ω–∏–µ SMA –∏–ª–∏ `None`, –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ**:
```json
{
  "ema_fast_len": 50,
  "ema_slow_len": 200
}
```

#### EMA (Exponential Moving Average)

```python
def ema(values: Sequence[float], length: int) -> float | None
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `values` ‚Äî —Å–ø–∏—Å–æ–∫ —Ü–µ–Ω
- `length` ‚Äî –ø–µ—Ä–∏–æ–¥ EMA

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –∑–Ω–∞—á–µ–Ω–∏–µ EMA –∏–ª–∏ `None`.

#### RSI (Relative Strength Index)

```python
def rsi(values: Sequence[float], length: int = 14) -> float | None
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `values` ‚Äî —Å–ø–∏—Å–æ–∫ —Ü–µ–Ω –∑–∞–∫—Ä—ã—Ç–∏—è
- `length` ‚Äî –ø–µ—Ä–∏–æ–¥ RSI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 14)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –∑–Ω–∞—á–µ–Ω–∏–µ RSI (0-100) –∏–ª–∏ `None`.

**–ü—Ä–∏–º–µ—Ä –≤ –∫–æ–Ω—Ñ–∏–≥–µ**:
```json
{
  "rsi_len": 14,
  "rsi_ovb": 70,
  "rsi_ovs": 30
}
```

#### Bollinger Bands

```python
def bollinger(
    values: Sequence[float],
    length: int = 20,
    mult: float = 2.0
) -> tuple[float | None, float | None, float | None]
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `values` ‚Äî —Å–ø–∏—Å–æ–∫ —Ü–µ–Ω
- `length` ‚Äî –ø–µ—Ä–∏–æ–¥ –¥–ª—è —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π
- `mult` ‚Äî –º–Ω–æ–∂–∏—Ç–µ–ª—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –∫–æ—Ä—Ç–µ–∂ `(middle, upper, lower)` –∏–ª–∏ `(None, None, None)`.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö**:
- `bb_middle` ‚Äî —Å—Ä–µ–¥–Ω—è—è –ª–∏–Ω–∏—è (SMA)
- `bb_upper` ‚Äî –≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞
- `bb_lower` ‚Äî –Ω–∏–∂–Ω—è—è –ø–æ–ª–æ—Å–∞
- `upperBB` ‚Äî –∞–ª–∏–∞—Å –¥–ª—è `bb_upper` (TradingView-style)
- `lowerBB` ‚Äî –∞–ª–∏–∞—Å –¥–ª—è `bb_lower` (TradingView-style)

**–ü—Ä–∏–º–µ—Ä –≤ –∫–æ–Ω—Ñ–∏–≥–µ**:
```json
{
  "bb_len": 20,
  "bb_mult": 2.0
}
```

#### ATR (Average True Range)

```python
def atr(
    highs: Sequence[float],
    lows: Sequence[float],
    closes: Sequence[float],
    length: int = 14
) -> float | None
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `highs` ‚Äî —Å–ø–∏—Å–æ–∫ –º–∞–∫—Å–∏–º—É–º–æ–≤
- `lows` ‚Äî —Å–ø–∏—Å–æ–∫ –º–∏–Ω–∏–º—É–º–æ–≤
- `closes` ‚Äî —Å–ø–∏—Å–æ–∫ —Ü–µ–Ω –∑–∞–∫—Ä—ã—Ç–∏—è
- `length` ‚Äî –ø–µ—Ä–∏–æ–¥ ATR

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –∑–Ω–∞—á–µ–Ω–∏–µ ATR –∏–ª–∏ `None`.

**–ü—Ä–∏–º–µ—Ä –≤ –∫–æ–Ω—Ñ–∏–≥–µ**:
```json
{
  "atr_len": 14,
  "atr_stop_mult": 1.5,
  "atr_tp_mult": 2.8
}
```

#### Volume MA (SMA –ø–æ –æ–±—ä—ë–º—É)

–í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∫ `sma(volume, vol_ma_len)`.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
- `vol_ma` ‚Äî SMA –æ–±—ä—ë–º–∞
- `vol_ma_scaled` ‚Äî `vol_ma * vol_mult` (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –æ–±—ä—ë–º–∞)

**–ü—Ä–∏–º–µ—Ä –≤ –∫–æ–Ω—Ñ–∏–≥–µ**:
```json
{
  "vol_ma_len": 21,
  "vol_mult": 0.5
}
```

### 2.3 –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö

–ü–æ–º–∏–º–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±–∞—Ä–∞:

- `open` ‚Äî —Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è
- `high` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
- `low` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
- `close` ‚Äî —Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
- `volume` ‚Äî –æ–±—ä—ë–º
- `hour` ‚Äî —á–∞—Å –±–∞—Ä–∞ (0-23) ‚Äî –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

### 2.4 –ö–∞–∫ –¥–≤–∏–∂–æ–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

1. **–î–∞–Ω–Ω—ã–µ –æ—Ç data_feed/backtester**: –¥–≤–∏–∂–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –±–∞—Ä—ã (OHLCV + timestamp) —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Bar`.

2. **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏**: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –±–∞—Ä–æ–≤ –≤ –±—É—Ñ–µ—Ä–∞—Ö (`deque`) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è (close, high, low, volume).

3. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤**: –Ω–∞ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –±–∞—Ä–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏–∑ `indicators.py`.

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**: –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±–∞—Ä–∞) –∏–ª–∏ `None`, –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö.

5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö**: –∑–Ω–∞—á–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–ª–æ–≤–∞—Ä–µ `indicators`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –¥–≤–∏–∂–æ–∫ –ø—Ä–∞–≤–∏–ª.

**–ü—Ä–∏–º–µ—Ä**:
```python
indicators = {
    "rsi": 25.3,
    "lowerBB": 50000.5,
    "upperBB": 52000.2,
    "vol_ma": 1500000,
    "vol_ma_scaled": 750000,  # vol_ma * 0.5
    "close": 51000,
    "volume": 2000000,
    "hour": 3.0
}
```

---

## 3. –§–æ—Ä–º–∞—Ç JSON-–ø—Ä–∞–≤–∏–ª (Trading Rules)

### 3.1 –û–±–∑–æ—Ä DSL (Domain Specific Language)

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π DSL –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞. –ü—Ä–∞–≤–∏–ª–∞ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –∏ —Å–æ—Å—Ç–æ—è—Ç –∏–∑ **—É—Å–ª–æ–≤–∏–π** (Condition) –∏ **–≥—Ä—É–ø–ø –ø—Ä–∞–≤–∏–ª** (RuleSet).

### 3.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å–ª–æ–≤–∏—è (Condition)

–ö–∞–∂–¥–æ–µ —É—Å–ª–æ–≤–∏–µ –∏–º–µ–µ—Ç —Ç—Ä–∏ –ø–æ–ª—è:

```json
{
  "left": "–Ω–∞–∑–≤–∞–Ω–∏–µ_–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞_–∏–ª–∏_–ø–æ–ª—è",
  "op": "–æ–ø–µ—Ä–∞—Ç–æ—Ä_—Å—Ä–∞–≤–Ω–µ–Ω–∏—è",
  "right": "–Ω–∞–∑–≤–∞–Ω–∏–µ_–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞_–∏–ª–∏_—á–∏—Å–ª–æ_–∏–ª–∏_–≤—ã—Ä–∞–∂–µ–Ω–∏–µ"
}
```

**–ü–æ–ª–µ `left`**:
- –ò–º—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∏–ª–∏ –ø–æ–ª—è: `"rsi"`, `"close"`, `"volume"`, `"lowerBB"`, `"hour"` –∏ —Ç.–¥.

**–ü–æ–ª–µ `op`** (–æ–ø–µ—Ä–∞—Ç–æ—Ä):
- `"<"` ‚Äî –º–µ–Ω—å—à–µ
- `">"` ‚Äî –±–æ–ª—å—à–µ
- `"<="` ‚Äî –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `">="` ‚Äî –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `"=="` ‚Äî —Ä–∞–≤–Ω–æ
- `"cross_above"` ‚Äî –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- `"cross_below"` ‚Äî –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑

**–ü–æ–ª–µ `right`**:
- –ß–∏—Å–ª–æ: `30`, `22`, `80`, `0.5` –∏ —Ç.–¥.
- –ò–º—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞: `"lowerBB"`, `"upperBB"`, `"ema_fast"` –∏ —Ç.–¥.
- –í—ã—Ä–∞–∂–µ–Ω–∏–µ: `"vol_ma * 0.5"`, `"atr * 2"`, `"bb_middle + 100"` –∏ —Ç.–¥.

### 3.3 –ì—Ä—É–ø–ø—ã –ø—Ä–∞–≤–∏–ª (RuleSet)

RuleSet —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö —Å–ø–∏—Å–∫–æ–≤ —É—Å–ª–æ–≤–∏–π:

```json
{
  "long_entry": [ /* —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ª–æ–Ω–≥ */ ],
  "short_entry": [ /* —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —à–æ—Ä—Ç */ ],
  "long_exit": [ /* —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –ª–æ–Ω–≥–∞ */ ],
  "short_exit": [ /* —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —à–æ—Ä—Ç–∞ */ ]
}
```

**–õ–æ–≥–∏–∫–∞**:
- –í—Å–µ —É—Å–ª–æ–≤–∏—è –≤ —Å–ø–∏—Å–∫–µ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ **–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò** (AND).
- –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π, —Å–∏–≥–Ω–∞–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è `False` (–Ω–µ—Ç –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞).

### 3.4 –ü—Ä–∏–º–µ—Ä—ã —É—Å–ª–æ–≤–∏–π

#### –ü—Ä–æ—Å—Ç–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —á–∏—Å–ª–æ–º

```json
{
  "left": "rsi",
  "op": "<",
  "right": 30
}
```

–û–∑–Ω–∞—á–∞–µ—Ç: `rsi < 30`

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

```json
{
  "left": "close",
  "op": ">",
  "right": "bb_upper"
}
```

–û–∑–Ω–∞—á–∞–µ—Ç: `close > bb_upper`

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º

```json
{
  "left": "volume",
  "op": ">",
  "right": "vol_ma * 1.5"
}
```

–û–∑–Ω–∞—á–∞–µ—Ç: `volume > (vol_ma * 1.5)`

#### –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä

```json
{
  "left": "hour",
  "op": ">=",
  "right": 0
}
```

–û–∑–Ω–∞—á–∞–µ—Ç: `hour >= 0` (—á–∞—Å >= 0)

#### –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ

```json
{
  "left": "ema_fast",
  "op": "cross_above",
  "right": "ema_slow"
}
```

–û–∑–Ω–∞—á–∞–µ—Ç: EMA –±—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ—Å–µ–∫–ª–∞ EMA –º–µ–¥–ª–µ–Ω–Ω—É—é —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö.

### 3.5 –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ RuleSet

```json
{
  "long_entry": [
    {"left": "rsi", "op": "<", "right": 30},
    {"left": "close", "op": "<=", "right": "lowerBB"},
    {"left": "volume", "op": ">", "right": "vol_ma * 1.2"}
  ],
  "short_entry": [
    {"left": "rsi", "op": ">", "right": 70},
    {"left": "close", "op": ">=", "right": "upperBB"}
  ],
  "long_exit": [
    {"left": "rsi", "op": ">", "right": 70}
  ],
  "short_exit": [
    {"left": "rsi", "op": "<", "right": 30}
  ]
}
```

**–õ–æ–≥–∏–∫–∞**:
- **–í—Ö–æ–¥ –≤ –ª–æ–Ω–≥**: RSI < 30 –ò —Ü–µ–Ω–∞ <= –Ω–∏–∂–Ω—è—è –ø–æ–ª–æ—Å–∞ –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞ –ò –æ–±—ä—ë–º > vol_ma * 1.2
- **–í—Ö–æ–¥ –≤ —à–æ—Ä—Ç**: RSI > 70 –ò —Ü–µ–Ω–∞ >= –≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞ –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞
- **–í—ã—Ö–æ–¥ –∏–∑ –ª–æ–Ω–≥–∞**: RSI > 70
- **–í—ã—Ö–æ–¥ –∏–∑ —à–æ—Ä—Ç–∞**: RSI < 30

### 3.6 –ö–∞–∫ –≤—Å—Ç–∞–≤–∏—Ç—å JSON-–ø—Ä–∞–≤–∏–ª–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –µ—Å—Ç—å –ø–æ–ª–µ **"Trading Rules"** (–∏–ª–∏ **"–ü—Ä–∞–≤–∏–ª–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏"**).

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ JSON-–∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∞–≤–∏–ª (RuleSet).
2. –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ "Trading Rules".
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç JSON –∏ —Å–æ–∑–¥–∞—Å—Ç –æ–±—ä–µ–∫—Ç `RuleSet`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π.

---

## 4. –ü—Ä–∏–º–µ—Ä: –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–∑ TradingView (Pine Script)

### 4.1 –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ Pine Script

```pinescript
//@version=5
strategy("ETH-5m –û–•–û–¢–ê –ù–û–ß–ù–û–ì–û –ö–û–¢–ê –°–ê–ú–£–†–ê–Ø", overlay=true,
     initial_capital=50,
     default_qty_type=strategy.percent_of_equity,
     default_qty_value=10, // 10% equity –∑–∞ 1-–π –≤—Ö–æ–¥
     pyramiding=4, // 4 —Å—Ç—É–ø–µ–Ω–∏ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
     commission_value=0.04,
     margin_long=0,
     margin_short=0)

// --------------- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã ---------------
rsiPeriod = input.int(14, "RSI –ø–µ—Ä–∏–æ–¥")
bbLen = input.int(20, "–ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä")
bbMult = input.float(2.0, "BB –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ")
tpLongPct = input.float(2.0, "TP long, %")
slLongPct = input.float(2.0, "SL long, %")
tpShPct = input.float(2.0, "TP short, %")
slShPct = input.float(2.0, "SL short, %")
volMult = input.float(0.5, "–û–±—ä—ë–º > x SMA(20)")
mult = input.float(1.5, "–ú–∞—Ä—Ç–∏–Ω–≥–µ–π–ª-–º–Ω–æ–∂–∏—Ç–µ–ª—å")

// --------------- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã ---------------
rsi = ta.rsi(close, rsiPeriod)
basis = ta.sma(close, bbLen)
dev = bbMult * ta.stdev(close, bbLen)
lowerBB = basis - dev
upperBB = basis + dev
volMA = ta.sma(volume, 21)

// --------------- –§–∏–ª—å—Ç—Ä –≤—Ä–µ–º–µ–Ω–∏ (00-07) ---------------
inTime = (hour >= 0) and (hour <= 7)

// --------------- –£—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞ ---------------
longCond = inTime and (rsi < 22) and (low <= lowerBB) and (volume > volMA * volMult)
shortCond = inTime and (rsi > 80) and (high >= upperBB) and (volume > volMA * volMult)

// --------------- –ú–∞—Ä—Ç–∏–Ω–≥–µ–π–ª-–ª–æ—Ç ---------------
step = strategy.closedtrades - strategy.opentrades
qty = math.pow(mult, step)

// --------------- –í—Ö–æ–¥—ã ---------------
if longCond and strategy.opentrades < 4
    strategy.entry("Lo", strategy.long, qty=qty)

if shortCond and strategy.opentrades < 4
    strategy.entry("Sh", strategy.short, qty=qty)

// --------------- –í—ã—Ö–æ–¥—ã (—Ä–∞–∑–¥–µ–ª—å–Ω—ã–µ) ---------------
if strategy.opentrades > 0
    if strategy.position_size > 0
        strategy.exit("ExL", from_entry="Lo",
             limit=strategy.position_avg_price * (1 + tpLongPct/100),
             stop =strategy.position_avg_price * (1 - slLongPct/100))
    if strategy.position_size < 0
        strategy.exit("ExS", from_entry="Sh",
             limit=strategy.position_avg_price * (1 - tpShPct/100),
             stop =strategy.position_avg_price * (1 + slShPct/100))
```

### 4.2 –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| Pine Script | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------------|----------|------------|
| `rsiPeriod` | 14 | –ü–µ—Ä–∏–æ–¥ RSI |
| `bbLen` | 20 | –ü–µ—Ä–∏–æ–¥ Bollinger Bands |
| `bbMult` | 2.0 | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è BB |
| `volMult` | 0.5 | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –æ–±—ä—ë–º–∞ |
| `tpLongPct` | 2.0 | Take Profit –¥–ª—è –ª–æ–Ω–≥–∞ (%) |
| `slLongPct` | 2.0 | Stop Loss –¥–ª—è –ª–æ–Ω–≥–∞ (%) |
| `tpShPct` | 2.0 | Take Profit –¥–ª—è —à–æ—Ä—Ç–∞ (%) |
| `slShPct` | 2.0 | Stop Loss –¥–ª—è —à–æ—Ä—Ç–∞ (%) |
| `pyramiding` | 4 | –ú–∞–∫—Å–∏–º—É–º –ø–∏—Ä–∞–º–∏–¥–∏–Ω–≥–æ–≤ |
| `mult` | 1.5 | –ú–∞—Ä—Ç–∏–Ω–≥–µ–π–ª-–º–Ω–æ–∂–∏—Ç–µ–ª—å |
| `default_qty_value` | 10 | –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (% –æ—Ç —ç–∫–≤–∏—Ç–∏) |

#### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

| Pine | –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|------|-----------|-----------|
| `rsi` | RSI | period=14 |
| `basis`, `lowerBB`, `upperBB` | Bollinger Bands | length=20, mult=2.0 |
| `volMA` | SMA –æ–±—ä—ë–º–∞ | length=21 |

#### –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä

```pinescript
inTime = (hour >= 0) and (hour <= 7)
```

–¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —Å 00:00 –¥–æ 07:00 (–ø–æ –±–∏—Ä–∂–µ).

#### –£—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞

**–õ–æ–Ω–≥**:
```pinescript
longCond = inTime and (rsi < 22) and (low <= lowerBB) and (volume > volMA * volMult)
```

**–®–æ—Ä—Ç**:
```pinescript
shortCond = inTime and (rsi > 80) and (high >= upperBB) and (volume > volMA * volMult)
```

#### –õ–æ–≥–∏–∫–∞ –ø–∏—Ä–∞–º–∏–¥–∏–Ω–≥–∞ –∏ –º–∞—Ä—Ç–∏–Ω–≥–µ–π–ª–∞

```pinescript
step = strategy.closedtrades - strategy.opentrades
qty = math.pow(mult, step)
```

- `step` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫ - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫
- `qty` = `mult^step` (1, 1.5, 2.25, 3.375 –∏ —Ç.–¥.)

#### Take Profit / Stop Loss

- **–õ–æ–Ω–≥**: TP = entry * (1 + tpLongPct/100), SL = entry * (1 - slLongPct/100)
- **–®–æ—Ä—Ç**: TP = entry * (1 - tpShPct/100), SL = entry * (1 + slShPct/100)

### 4.3 –ü–æ—à–∞–≥–æ–≤—ã–π –ø–µ—Ä–µ–Ω–æ—Å –≤ —Å–∏—Å—Ç–µ–º—É

#### –®–∞–≥ 1: –ü–µ—Ä–µ–Ω–æ—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤** ‚Üí `indicator_params`:

```json
{
  "rsi_len": 14,
  "bb_len": 20,
  "bb_mult": 2.0,
  "vol_ma_len": 21,
  "vol_mult": 0.5
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞** ‚Üí `risk_params`:

```json
{
  "base_size": 0.10,
  "pyramiding": 4,
  "martingale_mult": 1.5,
  "tp_long_pct": 2.0,
  "sl_long_pct": 2.0,
  "tp_short_pct": 2.0,
  "sl_short_pct": 2.0,
  "use_tp_sl": true
}
```

**–í—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä** ‚Üí `time_filter`:

```json
{
  "time_filter_enabled": true,
  "time_filter_start_hour": 0,
  "time_filter_end_hour": 7
}
```

#### –®–∞–≥ 2: –ü–µ—Ä–µ–Ω–æ—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

| Pine Script | –°–∏—Å—Ç–µ–º–∞ |
|-------------|---------|
| `rsi = ta.rsi(close, rsiPeriod)` | `indicators["rsi"]` ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| `basis, lowerBB, upperBB = bollinger(...)` | `indicators["lowerBB"]`, `indicators["upperBB"]` |
| `volMA = ta.sma(volume, 21)` | `indicators["vol_ma"]` |
| `hour` | `indicators["hour"]` ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ timestamp |

**–í—Å–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

#### –®–∞–≥ 3: –ü–µ—Ä–µ–Ω–æ—Å —É—Å–ª–æ–≤–∏–π –≤—Ö–æ–¥–∞ –≤ JSON-–ø—Ä–∞–≤–∏–ª–∞

**–ò—Å—Ö–æ–¥–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ –ª–æ–Ω–≥–∞**:
```pinescript
longCond = inTime and (rsi < 22) and (low <= lowerBB) and (volume > volMA * volMult)
```

**JSON-–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ª–æ–Ω–≥–∞**:

```json
{
  "long_entry": [
    {"left": "hour", "op": ">=", "right": 0},
    {"left": "hour", "op": "<=", "right": 7},
    {"left": "rsi", "op": "<", "right": 22},
    {"left": "low", "op": "<=", "right": "lowerBB"},
    {"left": "volume", "op": ">", "right": "vol_ma * 0.5"}
  ]
}
```

**–ò—Å—Ö–æ–¥–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ —à–æ—Ä—Ç–∞**:
```pinescript
shortCond = inTime and (rsi > 80) and (high >= upperBB) and (volume > volMA * volMult)
```

**JSON-–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —à–æ—Ä—Ç–∞**:

```json
{
  "short_entry": [
    {"left": "hour", "op": ">=", "right": 0},
    {"left": "hour", "op": "<=", "right": 7},
    {"left": "rsi", "op": ">", "right": 80},
    {"left": "high", "op": ">=", "right": "upperBB"},
    {"left": "volume", "op": ">", "right": "vol_ma * 0.5"}
  ]
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í—ã—Ä–∞–∂–µ–Ω–∏–µ `vol_ma * volMult` –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –∫–∞–∫ `"vol_ma * 0.5"` (—Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è).

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç**: –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä `vol_ma_scaled`:

```json
{"left": "volume", "op": ">", "right": "vol_ma_scaled"}
```

(–≥–¥–µ `vol_ma_scaled = vol_ma * vol_mult` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ –¥–≤–∏–∂–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

#### –®–∞–≥ 4: –ü–µ—Ä–µ–Ω–æ—Å –ª–æ–≥–∏–∫–∏ –ø–∏—Ä–∞–º–∏–¥–∏–Ω–≥–∞ –∏ –º–∞—Ä—Ç–∏–Ω–≥–µ–π–ª–∞

–í Pine Script:
```pinescript
step = strategy.closedtrades - strategy.opentrades
qty = math.pow(mult, step)
```

–í —Å–∏—Å—Ç–µ–º–µ:
```python
step = self._closed_trades_count - self._open_positions_count
size = self.config.base_size * (self.config.martingale_mult ** step)
```

**–≠—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤ –º–µ—Ç–æ–¥–µ `_calculate_position_size()` –∫–ª–∞—Å—Å–∞ `IndicatorStrategy`.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ:
```json
{
  "base_size": 0.10,
  "martingale_mult": 1.5,
  "pyramiding": 4
}
```

#### –®–∞–≥ 5: –ü–µ—Ä–µ–Ω–æ—Å Take Profit / Stop Loss

–í Pine Script:
```pinescript
strategy.exit("ExL", from_entry="Lo",
     limit=strategy.position_avg_price * (1 + tpLongPct/100),
     stop =strategy.position_avg_price * (1 - slLongPct/100))
```

–í —Å–∏—Å—Ç–µ–º–µ:
```python
self._tp_price = self._entry_price * (1 + self.config.tp_long_pct / 100)
self._sl_price = self._entry_price * (1 - self.config.sl_long_pct / 100)
```

**–≠—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤ –º–µ—Ç–æ–¥–∞—Ö `_set_tp_sl_for_long()` –∏ `_set_tp_sl_for_short()`.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ:
```json
{
  "tp_long_pct": 2.0,
  "sl_long_pct": 2.0,
  "tp_short_pct": 2.0,
  "sl_short_pct": 2.0,
  "use_tp_sl": true
}
```

### 4.4 –ü–æ–ª–Ω—ã–π JSON-–∫–æ–Ω—Ñ–∏–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–û–±—ä–µ–¥–∏–Ω—è—è –≤—Å–µ —á–∞—Å—Ç–∏, –ø–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–Ω—Ñ–∏–≥:

```json
{
  "strategy_type": "indicator",
  "mode": "quant_only",
  "symbol": "ETHUSDT",

  "rsi_len": 14,
  "bb_len": 20,
  "bb_mult": 2.0,
  "vol_ma_len": 21,
  "vol_mult": 0.5,

  "base_size": 0.10,
  "allow_long": true,
  "allow_short": true,

  "pyramiding": 4,
  "martingale_mult": 1.5,

  "tp_long_pct": 2.0,
  "sl_long_pct": 2.0,
  "tp_short_pct": 2.0,
  "sl_short_pct": 2.0,
  "use_tp_sl": true,

  "time_filter_enabled": true,
  "time_filter_start_hour": 0,
  "time_filter_end_hour": 7,

  "rules": {
    "long_entry": [
      {"left": "hour", "op": ">=", "right": 0},
      {"left": "hour", "op": "<=", "right": 7},
      {"left": "rsi", "op": "<", "right": 22},
      {"left": "low", "op": "<=", "right": "lowerBB"},
      {"left": "volume", "op": ">", "right": "vol_ma * 0.5"}
    ],
    "short_entry": [
      {"left": "hour", "op": ">=", "right": 0},
      {"left": "hour", "op": "<=", "right": 7},
      {"left": "rsi", "op": ">", "right": 80},
      {"left": "high", "op": ">=", "right": "upperBB"},
      {"left": "volume", "op": ">", "right": "vol_ma * 0.5"}
    ],
    "long_exit": [],
    "short_exit": []
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü–æ–ª—è `long_exit` –∏ `short_exit` –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø—É—Å—Ç—ã–º–∏, —Ç.–∫. –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã—Ö–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ TP/SL (–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ).

### 4.5 –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (RSI period, BB length –∏ —Ç.–¥.).
3. –í—Å—Ç–∞–≤—å—Ç–µ JSON –ø—Ä–∞–≤–∏–ª –≤ –ø–æ–ª–µ "Trading Rules":
```json
{
  "long_entry": [...],
  "short_entry": [...],
  "long_exit": [],
  "short_exit": []
}
```
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
from llm_trading_system.strategies.factory import create_strategy_from_config

config = {
    "strategy_type": "indicator",
    "mode": "quant_only",
    "symbol": "ETHUSDT",
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
}

strategy = create_strategy_from_config(config, llm_client=None)
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞

```python
from llm_trading_system.engine.backtester import Backtester
from llm_trading_system.engine.data_feed import CSVDataFeed
from llm_trading_system.strategies.factory import create_strategy_from_config

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
strategy = create_strategy_from_config(config, llm_client=None)

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
data_feed = CSVDataFeed(path="data/ETHUSDT_5m.csv", symbol="ETHUSDT")

# –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞
backtester = Backtester(
    strategy=strategy,
    data_feed=data_feed,
    initial_equity=50.0,  # initial_capital –∏–∑ Pine
    fee_rate=0.0004,      # commission_value / 100
    symbol="ETHUSDT"
)

result = backtester.run()

print(f"Final equity: {result.final_equity:.2f}")
print(f"Total return: {result.total_return:.2%}")
print(f"Max drawdown: {result.max_drawdown:.2%}")
print(f"Number of trades: {len(result.trades)}")
```

### 4.6 –û—Ç–ª–∏—á–∏—è –æ—Ç TradingView

#### –ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥

**TradingView**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π (entries) –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ö–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.

**–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞**: –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `PortfolioSimulator` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ **–æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é** –Ω–∞ —Å–∏–º–≤–æ–ª. –ü—Ä–∏ –Ω–æ–≤–æ–º –≤—Ö–æ–¥–µ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

**–ê–¥–∞–ø—Ç–∞—Ü–∏—è**: –ü–∞—Ä–∞–º–µ—Ç—Ä `pyramiding` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ú–∞—Ä—Ç–∏–Ω–≥–µ–π–ª-–º–Ω–æ–∂–∏—Ç–µ–ª—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ `step = closedtrades - opentrades`.

**–ë—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ**: –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å `PortfolioSimulator` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –ø–∏—Ä–∞–º–∏–¥–∏–Ω–≥–∞ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π).

#### TP/SL

**TradingView**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `strategy.exit()` —Å `limit` –∏ `stop`.

**–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞**: TP/SL –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –±–∞—Ä–µ —á–µ—Ä–µ–∑ `_check_tp_sl_hit()`. –ï—Å–ª–∏ `bar.high >= tp_price` (–¥–ª—è –ª–æ–Ω–≥–∞) –∏–ª–∏ `bar.low <= sl_price`, –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

**–¢–æ—á–Ω–æ—Å—Ç—å**: –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ TP/SL –º–æ–≥—É—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –±–∞—Ä–∞. –í –±—ç–∫—Ç–µ—Å—Ç–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ high/low –±–∞—Ä–∞.

---

## 5. –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

### 5.1 –ï—Å–ª–∏ –≤—Å–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —É–∂–µ –µ—Å—Ç—å

–ï—Å–ª–∏ –≤–∞—à–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, SMA, EMA, BB, ATR, vol_ma), –≤–∞–º –ù–ï –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∫–æ–¥.

**–®–∞–≥–∏**:

1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤**: –ö–∞–∫–∏–µ –ø–µ—Ä–∏–æ–¥—ã, –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –∏ —Ç.–¥.
2. **–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —É—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞**: –í —Ç–µ—Ä–º–∏–Ω–∞—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π.
3. **–°–æ–∑–¥–∞–π—Ç–µ JSON-–ø—Ä–∞–≤–∏–ª–∞**: –ò—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º–∞—Ç RuleSet.
4. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**: –û–±—ä–µ–¥–∏–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –ø—Ä–∞–≤–∏–ª–∞.
5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫—Ç–µ—Å—Ç**: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ.

**–ü—Ä–∏–º–µ—Ä**: –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è RSI

```json
{
  "strategy_type": "indicator",
  "mode": "quant_only",
  "symbol": "BTCUSDT",
  "rsi_len": 14,
  "base_size": 0.05,
  "allow_long": true,
  "allow_short": true,
  "rules": {
    "long_entry": [
      {"left": "rsi", "op": "<", "right": 30}
    ],
    "short_entry": [
      {"left": "rsi", "op": ">", "right": 70}
    ],
    "long_exit": [
      {"left": "rsi", "op": ">", "right": 70}
    ],
    "short_exit": [
      {"left": "rsi", "op": "<", "right": 30}
    ]
  }
}
```

### 5.2 –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

–ï—Å–ª–∏ –≤–∞—à–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Stochastic, CCI, Ichimoku –∏ —Ç.–¥.), –≤–∞–º –Ω—É–∂–Ω–æ:

#### –®–∞–≥ 1: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `llm_trading_system/strategies/indicators.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é:

```python
def stochastic(
    highs: Sequence[float],
    lows: Sequence[float],
    closes: Sequence[float],
    k_period: int = 14,
    d_period: int = 3
) -> tuple[float | None, float | None]:
    """Calculate Stochastic Oscillator (%K, %D).

    Args:
        highs: High prices
        lows: Low prices
        closes: Close prices
        k_period: Period for %K
        d_period: Period for %D (SMA of %K)

    Returns:
        Tuple of (%K, %D) or (None, None)
    """
    if len(highs) < k_period or len(lows) < k_period or len(closes) < k_period:
        return None, None

    # %K = (Close - Low(k_period)) / (High(k_period) - Low(k_period)) * 100
    recent_highs = highs[-k_period:]
    recent_lows = lows[-k_period:]
    highest = max(recent_highs)
    lowest = min(recent_lows)

    if highest == lowest:
        return 50.0, None

    k = ((closes[-1] - lowest) / (highest - lowest)) * 100

    # %D = SMA of %K (requires k_history)
    # –î–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é %K

    return k, None
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Stochastic –Ω—É–∂–Ω–æ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é %K –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è %D.

#### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≤ IndicatorStrategy

–û—Ç–∫—Ä–æ–π—Ç–µ `llm_trading_system/strategies/indicator_strategy.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤ –º–µ—Ç–æ–¥ `_compute_indicators()`:

```python
def _compute_indicators(self, bar: Bar | None = None) -> dict[str, float | None]:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

    # Stochastic
    if hasattr(self.config, 'stoch_k_period'):
        stoch_k, stoch_d = stochastic(
            highs_list, lows_list, closes_list,
            self.config.stoch_k_period,
            self.config.stoch_d_period
        )
        indicators["stoch_k"] = stoch_k
        indicators["stoch_d"] = stoch_d

    return indicators
```

#### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–û—Ç–∫—Ä–æ–π—Ç–µ `llm_trading_system/strategies/configs.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—è:

```python
@dataclass
class IndicatorStrategyConfig:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...

    # Stochastic parameters
    stoch_k_period: int = 14
    stoch_d_period: int = 3
```

#### –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `stoch_k` –∏ `stoch_d` –≤ JSON-–ø—Ä–∞–≤–∏–ª–∞—Ö:

```json
{
  "long_entry": [
    {"left": "stoch_k", "op": "<", "right": 20},
    {"left": "stoch_k", "op": "cross_above", "right": "stoch_d"}
  ]
}
```

### 5.3 –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–æ–±—ã—á–Ω–æ `http://localhost:5000` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π).
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é".
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: **Indicator** (–∏–ª–∏ **Combined** –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞).
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - Symbol
   - RSI length, BB length, vol_mult –∏ —Ç.–¥.
   - Base size, pyramiding, martingale_mult
   - TP/SL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä
5. –í—Å—Ç–∞–≤—å—Ç–µ JSON-–ø—Ä–∞–≤–∏–ª–∞ –≤ –ø–æ–ª–µ "Trading Rules".
6. –ù–∞–∂–º–∏—Ç–µ "Save Strategy".

### 5.4 –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ CLI

```bash
python -m llm_trading_system.cli.full_cycle_cli \
    --config strategies/my_strategy.json \
    --data data/BTCUSDT_5m.csv \
    --symbol BTCUSDT \
    --initial-equity 10000
```

---

## 6. –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å LLM-—Ä–µ–∂–∏–º–æ–º

### 6.1 –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `mode` –≤ –∫–æ–Ω—Ñ–∏–≥–µ):

#### QUANT_ONLY

–ß–∏—Å—Ç–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM.

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- –ü—Ä–∞–≤–∏–ª–∞ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ JSON DSL
- LLM –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–ö–æ–Ω—Ñ–∏–≥**:
```json
{
  "mode": "quant_only",
  "strategy_type": "indicator",
  "rules": { ... }
}
```

#### LLM_ONLY

–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ LLM (–±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤).

- LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ —Å–Ω–∏–º–∫–∏ (market snapshots)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `prob_bull`, `prob_bear`, `k_long`, `k_short`
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ = `base_size * k_long` (–∏–ª–∏ `k_short`)

**–ö–æ–Ω—Ñ–∏–≥**:
```json
{
  "mode": "llm_only",
  "strategy_type": "combined"
}
```

#### HYBRID

–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ LLM.

- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ (—á–µ—Ä–µ–∑ JSON-–ø—Ä–∞–≤–∏–ª–∞)
- LLM –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "—Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞" –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã `k_long`, `k_short`
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –º–æ–¥—É–ª–∏—Ä—É–µ—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ LLM

**–ö–æ–Ω—Ñ–∏–≥**:
```json
{
  "mode": "hybrid",
  "strategy_type": "combined",
  "rules": { ... }
}
```

### 6.2 –ö–∞–∫ LLM –≤–ª–∏—è–µ—Ç –Ω–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

–í —Ä–µ–∂–∏–º–µ **HYBRID**:

1. **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª –≤—Ö–æ–¥–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª).
2. **LLM-—Ä–µ–∂–∏–º** –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:
   - `k_long` ‚Äî –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –ª–æ–Ω–≥-–ø–æ–∑–∏—Ü–∏–π (0.0 - 2.0)
   - `k_short` ‚Äî –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è —à–æ—Ä—Ç-–ø–æ–∑–∏—Ü–∏–π (0.0 - 2.0)
3. **–ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏**:
   - –î–ª—è –ª–æ–Ω–≥–∞: `size = base_size * k_long`
   - –î–ª—è —à–æ—Ä—Ç–∞: `size = base_size * k_short`

**–ü—Ä–∏–º–µ—Ä—ã**:

- –ï—Å–ª–∏ `k_long = 0.0` ‚Üí –ª–æ–Ω–≥–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è (–¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏–≥–Ω–∞–ª –æ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)
- –ï—Å–ª–∏ `k_long = 2.0` ‚Üí —Ä–∞–∑–º–µ—Ä –ª–æ–Ω–≥-–ø–æ–∑–∏—Ü–∏–∏ —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è
- –ï—Å–ª–∏ `k_short = 0.5` ‚Üí —Ä–∞–∑–º–µ—Ä —à–æ—Ä—Ç-–ø–æ–∑–∏—Ü–∏–∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤–¥–≤–æ–µ

### 6.3 –ü—Ä–∏–º–µ—Ä HYBRID —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```json
{
  "mode": "hybrid",
  "strategy_type": "combined",
  "symbol": "BTCUSDT",

  "rsi_len": 14,
  "bb_len": 20,
  "bb_mult": 2.0,

  "base_size": 0.05,
  "k_max": 2.0,

  "llm_refresh_interval_bars": 30,
  "llm_min_prob_edge": 0.05,
  "llm_min_trend_strength": 0.2,

  "rules": {
    "long_entry": [
      {"left": "rsi", "op": "<", "right": 30},
      {"left": "close", "op": "<=", "right": "lowerBB"}
    ],
    "short_entry": [
      {"left": "rsi", "op": ">", "right": 70},
      {"left": "close", "op": ">=", "right": "upperBB"}
    ],
    "long_exit": [
      {"left": "rsi", "op": ">", "right": 70}
    ],
    "short_exit": [
      {"left": "rsi", "op": "<", "right": 30}
    ]
  }
}
```

**–õ–æ–≥–∏–∫–∞**:

- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –∫–æ–≥–¥–∞ –≤—Ö–æ–¥–∏—Ç—å (RSI < 30 –∏ —Ü–µ–Ω–∞ —É –Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å—ã BB)
- LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫ –∫–∞–∂–¥—ã–µ 30 –±–∞—Ä–æ–≤ –∏ —Ä–µ—à–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –≤—Ö–æ–¥–∏—Ç—å
- –ï—Å–ª–∏ LLM –≤–∏–¥–∏—Ç —Å–∏–ª—å–Ω—ã–π –±—ã—á–∏–π —Ä–µ–∂–∏–º ‚Üí `k_long = 2.0` ‚Üí —É–¥–≤–æ–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ª–æ–Ω–≥–∞
- –ï—Å–ª–∏ LLM –≤–∏–¥–∏—Ç –º–µ–¥–≤–µ–∂–∏–π —Ä–µ–∂–∏–º ‚Üí `k_long = 0.0` ‚Üí –ª–æ–Ω–≥–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

### 6.4 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LLM-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**llm_refresh_interval_bars**:
- –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—Ç—å LLM-—Ä–µ–∂–∏–º (–≤ –±–∞—Ä–∞—Ö)
- –ù–∞–ø—Ä–∏–º–µ—Ä, `30` = –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 30 –±–∞—Ä–æ–≤ (2.5 —á–∞—Å–∞ –Ω–∞ 5m —Ç–∞–π–º—Ñ—Ä–µ–π–º–µ)

**llm_min_prob_edge**:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ `|prob_bull - prob_bear|` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
- –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–Ω—å—à–µ ‚Üí `k_long = k_short = 1.0` (–Ω–µ—Ç –≤–ª–∏—è–Ω–∏—è LLM)

**llm_min_trend_strength**:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
- –ï—Å–ª–∏ `trend_strength < llm_min_trend_strength` ‚Üí `k_long = k_short = 1.0`

**k_max**:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–æ–±—ã—á–Ω–æ 2.0)
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏

### 6.5 –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–µ–∂–∏–º

| –†–µ–∂–∏–º | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------|--------------------|
| **QUANT_ONLY** | –ß–∏—Å—Ç–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –Ω–µ –Ω—É–∂–µ–Ω –∞–Ω–∞–ª–∏–∑ LLM |
| **LLM_ONLY** | –ü–æ–ª–∞–≥–∞–µ—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–Ω–∞–ª–∏–∑ LLM (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥) |
| **HYBRID** | –•–æ—Ç–∏—Ç–µ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ "–ø–æ–Ω–∏–º–∞–Ω–∏–µ" —Ä—ã–Ω–∫–∞ –æ—Ç LLM |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ –Ω–∞—á–∏–Ω–∞–π—Ç–µ —Å **QUANT_ONLY**, –∑–∞—Ç–µ–º —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ **HYBRID** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–∏–±–∫–∏–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:

‚úÖ **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤** ‚Äî –≥–æ—Ç–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, BB, SMA, EMA, ATR –∏ –¥—Ä.)

‚úÖ **JSON DSL** ‚Äî –ø—Ä–æ—Å—Ç–æ–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞

‚úÖ **–ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥ –∏ –º–∞—Ä—Ç–∏–Ω–≥–µ–π–ª** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–µ–π

‚úÖ **TP/SL** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ Take Profit –∏ Stop Loss

‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã** ‚Äî —Ç–æ—Ä–≥–æ–≤–ª—è –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —á–∞—Å—ã

‚úÖ **LLM-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å –∞–Ω–∞–ª–∏–∑–æ–º LLM

‚úÖ **–ë—ç–∫—Ç–µ—Å—Ç–µ—Ä** ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–∑—É—á–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã** –≤ —Ä–∞–∑–¥–µ–ª–µ 4 (–ø–µ—Ä–µ–Ω–æ—Å Pine Script —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
2. **–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é** —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫—Ç–µ—Å—Ç** –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. **–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (—Ä–∞–∑–¥–µ–ª 5.2)
5. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å HYBRID —Ä–µ–∂–∏–º–æ–º** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–£–¥–∞—á–∏ –≤ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ!** üöÄüìà
